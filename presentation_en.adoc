= ğŸ¥‹ Karate  ğŸ¥° â„ï¸ Snowflake
:source-highlighter: highlight.js
:highlightjs-languages: gherkin
:icons: font

ğŸ‡«ğŸ‡· _Ne ratez pas votre SQL avec un test Karate_

ğŸ‡¬ğŸ‡§ _Don't miss your SQL code with a Karate test_


== ğŸª„ Once upon a time... âœ¨
A great data pipeline !

image::images/data-pipeline-simple.png[]

[%notitle]
=== Lectra Context
image::diagrams/iot.svg[background,size=contain]

=== $ whoami ğŸ‘¨â€ğŸ’»
* Mehdi REBIAI
* ğŸ§‘â€ğŸ”§ Tech Lead & Data Engineer @Lectra
* icon:github[] https://github.com/mrebiai
* https://github.com/lectra-tech/kapoeira[Kapoeira Maintainer]

=== A great pipeline... but sometimes... ğŸ˜¥
Not so great... more complex

image:images/data-pipeline-dirty.jpg[height=290] image:images/data-pipeline-complex.jpg[height=290]

=== ğŸ’¡We need Tests ğŸ¤— & QA ğŸ•µï¸ ğŸ›

But also some tools...

== Let's talk about architecture ğŸ‘·

ETL vs ELT...

[%notitle]
=== ETL
image::diagrams/data-pipeline-etl.svg[background,size=contain]

=== image:images/snowflake-text.png[]
* Data Cloud... DBMS++
* Snowpark, Stream/Task...
* STORAGE ğŸ’° dissociated from COMPUTE ğŸ’°ğŸ’°ğŸ’°
* Scalable COMPUTE

[.columns]
=== image:images/kapoeira-text.svg[width=100]
[.column]
* Kafka IT tests with JAR or Docker Image
* Gherkin & Cucumber (Scala)
* Code: https://github.com/lectra-tech/kapoeira[^]
* Slides: https://jvauchel.github.io/kapoeira-dance/[^]

[.column]
video::ELFCAgdgSro[youtube, width=500]

=== Kapoeira - Example (1/2)
image::images/burger-factory.svg[width=800]

=== Kapoeira - Example (2/2)
[source, gherkin]
----
include::features/kapoeira/burger-factory.feature[]
----

[%notitle]
=== ELT
image::diagrams/data-pipeline-elt.svg[background,size=contain]

[.columns]
=== image:images/karatelabs.png[width=200]
[.column]
* REST API tests (and more...) with a simple JAR
* Gherkin
* Code: https://github.com/karatelabs/karate[^]

[.column]
video::NYlPxd5dZOU[youtube, width=500]

=== Karate - Example
[source, gherkin]
----
include::features/karate/hello-world.feature[]
----

=== Karate - HTTP+++<br/>+++Snowflake - JDBC SQL+++<br/>+++ğŸ¤”
[%step]
* https://docs.snowflake.com/en/developer-guide/snowflake-rest-api/snowflake-rest-api[Snowflake REST API & Authentication^]
* https://docs.snowflake.com/en/developer-guide/sql-api/index[Snowflake SQL API^]
* ğŸ˜ƒ

[.columns]
=== INSERT/SELECT Karate âœ…+++<br/>+++Run Task & DBT ?ğŸ¤”
[.column]
image::diagrams/data-pipeline-elt.svg[width=500]

[.column]
[%step]
* `karate.exec(<command>)`
* Karate DSL extension - https://github.com/karatelabs/karate-examples[Examples^]
* ğŸ˜ƒ

=== Lectra Karate Tool
* Fat JAR (karate.jar + extensions) or Docker Image (with all you need)
* ğŸ˜ƒ

== Lectra Karate Tool
TODO
