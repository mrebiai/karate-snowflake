= ğŸ¥‹ Karate Connect
:source-highlighter: highlight.js
:highlightjs-languages: gherkin
:icons: font

ğŸ‡«ğŸ‡· _votre partenaire de combat dans l'arÃ¨ne des tests API_

ğŸ‡¬ğŸ‡§ _your battle partner in the API testing arena_


== ğŸª„ Once upon a time... âœ¨
[%step]
A great data pipeline !

[%step]
image::images/data-pipeline-simple.png[]

[%notitle]
=== Lectra Context
image::diagrams/iot.svg[background,size=contain]

=== $ whoami ğŸ‘¨â€ğŸ’»
[%step]
* Mehdi REBIAI
* ğŸ§‘â€ğŸ”§ Tech Lead & Data Engineer @Lectra
* icon:github[] https://github.com/mrebiai
* https://github.com/lectra-tech/kapoeira[Kapoeira^] & https://github.com/lectra-tech/karate-connect[Karate Connect^] maintainer

=== A great pipeline... but sometimes... ğŸ˜¥
[%step]
Not so great... more complex

[%step]
image:images/data-pipeline-dirty.jpg[height=290] image:images/data-pipeline-complex.jpg[height=290]

=== ğŸ’¡We need Tests ğŸ¤— & QA ğŸ•µï¸ ğŸ›
[%step]
But also some tools...

== Let's talk about architecture ğŸ‘·
ETL vs ELT...

[%notitle]
=== ETL
image::diagrams/data-pipeline-etl.svg[background,size=contain]

[.columns]
=== image:images/kapoeira-text.svg[width=100]
[.column]
[%step]
* Kafka IT tests (â˜• / ğŸ³)
* Gherkin & Cucumber (Scala)
* Code: https://github.com/lectra-tech/kapoeira[^]

[.column]
[%step]
video::ELFCAgdgSro[youtube, width=500]

=== Kapoeira
image::images/fries-factory.svg[width=500]

[source, gherkin]
----
include::features/kapoeira/fries-factory.feature[]
----

[%notitle]
=== ELT
image::diagrams/data-pipeline-elt.svg[background,size=contain]

[.columns]
=== image:images/karatelabs.png[width=200]
[.column]
[%step]
* REST API tests, and more... (â˜•)
* Gherkin
* Code: https://github.com/karatelabs/karate[^]

[.column]
[%step]
video::NYlPxd5dZOU[youtube, width=500]

=== Karate - Example
[source, gherkin]
----
include::features/karate/hello-world.feature[]
----

=== Karate calling Snowflake REST API
[source, gherkin]
----
include::features/karate/select-v1.feature[]
----

=== Karate API Testing ğŸ‘ & ğŸ‘
[%autowidth]
|===
| | Ok? | Comments
| Snowflake | âœ… | But complex API
| Kafka | âŒ | Closed source addon
| Rabbitmq | âŒ | Just code example for addon
| DBT | âœ… | Thanks to `karate.exec(...)`
|===

== ğŸ’¡ Karate Connect =+++<br/>+++Karate Core + Extensions ready to use

.DSL syntax
[source, gherkin]
----
* def result1 = <extension>.<value>
* def result2 = <extension>.<feature>.<function>(args)
----

.Example
[source, gherkin]
----
* json cliConfig     = snowflake.cliConfigFromEnv
* def rabbitmqClient = rabbitmq.topology.createClient({ host: "localhost", port: 5672 })
----


=== Packaging+++<br/>+++image:diagrams/packaging.svg[width=550]

=== How to run ?
[%step]
.â˜•
[source, bash]
----
java -Dextensions=<ext1,ext2...> \
    -jar karate-connect-standalone.jar \
    <features_path> <optional_params...>
----

[%step]
.ğŸ³
[source, bash, indent=0]
----
docker run --rm \
  -v $(pwd)/<features_path>:/features \
  -v $(pwd)/<reports_path>:/target \
  -e KARATE_EXTENSIONS=<ext1,ext2...>  -e ... \
  karate-connect:latest <optional_params...>
----

=== How to customize ?
See https://karatelabs.github.io/karate[karate documentation^] for anything related to Karate Core.

=== All existing extensions
[%autowidth]
* https://github.com/lectra-tech/karate-connect?tab=readme-ov-file#base[`base`^]: common functions (uuid, time, ...)
* https://github.com/lectra-tech/karate-connect?tab=readme-ov-file#rabbitmq[`rabbitmq`^]: RabbitMQ integration
* https://github.com/lectra-tech/karate-connect?tab=readme-ov-file#kafka[`kafka`^]: Kafka integration
* https://github.com/lectra-tech/karate-connect?tab=readme-ov-file#snowflake[`snowflake`^]: Snowflake integration
* https://github.com/lectra-tech/karate-connect?tab=readme-ov-file#kubernetes[`kubernetes`^]: `kubectl create job -from=cronjob/...`
* https://github.com/lectra-tech/karate-connect?tab=readme-ov-file#dbt[`dbt`^]: `dbt run ...`

=== More? (coming soon)
* `redis`
* `mongodb`
* `jdbc` (+ jar for JDBC driver)
* your private extension (built by yourself) and loaded in karate-connect classpath

=== Snowflake extension - Example
[source, gherkin]
----
include::features/karate/select-v2.feature[]
----

[.columns]
== Demo Time ğŸ¬

* https://medium.com/snowflake/streaming-data-from-snowflake-to-kafka-ed76ce0400c2


== Next Steps ğŸš€
* We need stars ğŸŒŸ!
* We need contributors ğŸ™!

https://github.com/lectra-tech/karate-connect[^]

[background-color="white"]
[.columns]
== ğŸ‰ Thank you - Questions?+++<br/>+++ğŸ¥‹
[.column]
Slides ğŸ–¥ï¸::
image:images/qrcode-slides.png[width=300]

[.column]
FeedbackğŸ™::
image:images/qrcode-{confName}-feedback.png[width=300]